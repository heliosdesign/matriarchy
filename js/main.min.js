(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var r={master:{},slaveRight:{},slaveLeft:{}},i={master:document.getElementById("master-video"),slaveRight:document.getElementById("slave-right-video"),slaveLeft:document.getElementById("slave-left-video"),init:function(){i.listeners();i.master.load()},listeners:function(){i.master.oncanplaythrough=function(){console.log("Master Can Play");r.master.ready=!0;i.slaveRight.load()};i.master.onwaiting=function(){console.log("Master is waiting for buffer");r.master.playing=!1;if(r.slaveRight.playing){i.slaveRight.pause();r.slaveRight.playing=!1}window.cancelAnimationFrame()};i.master.onstalled=function(){console.log("stalled")};i.master.onplaying=function(){console.log("Master is playing");$(".panel").is(":hidden")&&$(".panel").fadeIn(1e3);if(!r.slaveRight.playing){i.slaveRight.play();r.slaveRight.playing=!0}i.sync()};i.slaveRight.oncanplaythrough=function(){console.log("Right slave can play.");r.slaveRight.ready=!0;i.slaveLeft.load()};i.slaveLeft.oncanplaythrough=function(){console.log("Left slave can play.");r.slaveLeft.ready=!0;i.master.play();r.master.playing=!0};$("#main-nav a").on("click",function(){var e=$(this).attr("id");i.switchVideo(e)})},sync:function(){Math.abs(i.master.currentTime-i.slaveRight.currentTime)>.2&&i.master.currentTime<i.slaveRight.duration&&(i.slaveRight.currentTime=i.master.currentTime);Math.abs(i.master.currentTime-i.slaveLeft.currentTime)>.2&&i.master.currentTime<i.slaveLeft.duration&&(i.slaveLeft.currentTime=i.master.currentTime);window.requestAnimationFrame(i.sync)},switchVideo:function(e){i.master.pause();i.slaveRight.pause();i.slaveLeft.pause();r.master.playing=!1;r.slaveRight.playing=!1;r.slaveLeft.playing=!1;$(".panel").fadeOut(1e3,function(){i.master.src="assets/video/"+e+"_master.webm";i.slaveRight.src="assets/video/"+e+"_slave_right.webm";i.slaveLeft.src="assets/video/"+e+"_slave_left.webm";i.master.load()})}};Handlers={init:function(){$("#left-panel").hover(function(){$("#vid-wrapper").addClass("show-left")},function(){$("#vid-wrapper").removeClass("show-left")});$("#right-panel").hover(function(){$("#vid-wrapper").addClass("show-right")},function(){$("#vid-wrapper").removeClass("show-right")})}};i.init();Handlers.init()})();