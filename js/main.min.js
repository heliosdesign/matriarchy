(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var r={master:{},slave:{}},i={master:document.getElementById("master-video"),slave:document.getElementById("slave-video"),init:function(){i.listeners();i.master.load()},listeners:function(){i.master.oncanplaythrough=function(){console.log("Master Can Play");r.master.ready=!0;i.slave.load()};i.master.onwaiting=function(){console.log("Master is waiting for buffer");r.master.playing=!1;if(r.slave.playing){i.slave.pause();r.slave.playing=!1}window.cancelAnimationFrame()};i.master.onstalled=function(){console.log("stalled")};i.master.onplaying=function(){console.log("Master is playing");$(".panel").is(":hidden")&&$(".panel").fadeIn(1e3);if(!r.slave.playing){i.slave.play();r.slave.playing=!0}i.sync()};i.slave.oncanplaythrough=function(){console.log("Slave can play.");r.slave.ready=!0;i.master.play();r.master.playing=!0};$("#main-nav a").on("click",function(){var e=$(this).attr("id");i.switchVideo(e)})},sync:function(){Math.abs(i.master.currentTime-i.slave.currentTime)>.2&&i.master.currentTime<i.slave.duration&&(i.slave.currentTime=i.master.currentTime);window.requestAnimationFrame(i.sync)},switchVideo:function(e){i.master.pause();i.slave.pause();r.master.playing=!1;r.slave.playing=!1;$(".panel").fadeOut(1e3,function(){i.master.src="assets/video/"+e+"_master.webm";i.slave.src="assets/video/"+e+"_slave.webm";i.master.load()})}};i.init()})();